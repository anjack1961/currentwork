ユーザによるシークレット登録

前提条件
●シークレットエンジン有効化
SecretEngin: kv-v2
SecretEnginPath: enginpath(任意)
●ポリシー登録
Policyname: user02(任意)
Path: enginpath/*
capabilities: ["create", "update", "patch", "read", "delete"]
●ユーザーパス認証方法を有効
認証方法: userpass
●Userpass認証構成
ユーザ名: user02(任意)
構成ファイル: auth/userpass/users/user02
Password: JMCVF7eO4Oox8CZ(任意)
Policyname: user02 

上記の設定が終了していることでユーザによるシークレット登録/更新/削除ができる。


管理者への連携
SecretEnginPath: enginpath(任意)
Policyname: user02(任意)
ユーザ名: user02(任意)
Password: JMCVF7eO4Oox8CZ(任意)
Path for this seacret: testgp/testuser(任意)

●Kubernetes認証ロール作成
KubernetesRoleDir: auth/kubernetes/role
Rolename: k8srole
kubernetes名前空間: vaultspace
ServiceAccount: vaultuser
Policyname: read_user01
Ttl: 24h



vault_user_make_secret01
①Create Secret を押下する。

vault_user_make_secret02
② 各入力箇所へ入力する。
Path for this seacret: testgp/testuser(任意)
Key1  : testkey
Value1: testkey
Key2  : pass
Value2: testpass

vault_user_make_secret03
③ Save を押下する。

vault_user_make_secret04
④ 登録したシークレットを確認する。

⑤ Create new version を押下する。

vault_user_make_secret05
⑥ Key&Value を追加する。また、更新が必要な個所を更新する。
Key3  : testvalue
Value3: testvalue
Key4  : test
Value4: test

⑦ Save を押下する。

vault_user_make_secret06
⑧ 登録・更新したシークレットを確認する。

vault_user_make_secret07
⑨ View version history を押下する。

vault_user_make_secret08
⑩ 過去のシークレットのバージョンが表示される。

vault_user_make_secret09
⑪ シークレットがバージョン単位で削除できる。
または、すべてのバージョンを削除できる。
delete と destroy の明確な区別は不明。


